# PyKotor Rules – AI Agent Edition (2025)

## 1. Git Commit – ABSOLUTE LAW

YOU MUST commit EVERY file change using ONE chained command:

```powershell
git add file1.py file2.py; git commit -m "type: message"
```

Rules:
- NEVER use wildcards: no `git add .`, no `git add *`
- List EVERY file explicitly
- Use conventional commits: `fix:`, `feat:`, `refactor:`, `docs:`, `chore:`, `test:`
- Verify success: command must exit with code 0

## 2. Documentation

New .md files → only in `docs/`  
Content → only public-facing, end-user or developer info  
NEVER write progress reports or TODOs

## 3. Helper Scripts (scripts/)

Always:
- Use argparse / param() with defaults
- Follow POSIX flags: `-h`, `--help`, `-v`, etc.
- Output formats: text, json, compact
- Exit codes: 0 = success, >0 = error
- Keep scripts forever — do NOT delete them

## 4. Terminal & Git

- Use `--no-pager` on ALL git commands that may page
- PowerShell is default (Windows target)
- NEVER run tests without timeout: 120s individual, 300s suite

Test example:
```powershell
. .\.venv_3.13\Scripts\Activate.ps1
$proc = Start-Process python -ArgumentList "-m pytest tests/..." -PassThru -NoNewWindow
if (-not $proc.WaitForExit(300000)) { $proc.Kill(); Write-Host "TIMEOUT" }
```

## 5. Wiki Maintenance – MANDATORY

After discovering ANY new info about:
- File formats
- Game mechanics
- Code relationships

YOU MUST:
1. Check `wiki/*.md` exists
2. Update or create missing docs
3. Commit to wiki repo:
   ```powershell
   cd wiki
   git add file.md; git commit -m "docs: description"
   cd ..
   ```

## 6. Code Conventions

- Search `./vendor` for similar code → add comment with path/line
- Prefer `isinstance` over `hasattr`/`getattr`
- Use `ruff` only for linting
- NEVER edit generated files → fix source and regenerate

## 7. KotorCLI Priority

ALWAYS prefer CLI over raw Python:
- `uv run python -m kotorcli …`
- Use `list`, `extract`, `search-archive --content`, `diff`, `validate`, etc.

## 8. Paths & Environment

- K1 → `$Env:K1_PATH` or default
- K2 → `$Env:K2_PATH` or `$Env:TSL_PATH`
- Run from repo root so `Libraries/` is on `PYTHONPATH`

## Final Rule

Follow these rules exactly.  
Every deviation is a violation.