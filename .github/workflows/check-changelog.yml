name: Check Changelog

on:
  pull_request:
    branches: [ main, develop ]
  workflow_dispatch:

jobs:
  check-changelog:
    name: Check Changelog
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check for changelog entry
        uses: actions/github-script@v7
        with:
          script: |
            const { data: files } = await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number,
            });

            const hasChangelog = files.some(file => 
              file.filename.includes('CHANGELOG') || 
              file.filename.includes('changelog') ||
              file.filename.includes('RELEASE_NOTES')
            );

            const isChore = context.payload.pull_request.title.toLowerCase().includes('chore');
            const isDocs = context.payload.pull_request.title.toLowerCase().includes('docs');
            const isCI = context.payload.pull_request.title.toLowerCase().includes('ci');

            if (!hasChangelog && !isChore && !isDocs && !isCI) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                body: `üìù **Changelog Entry Reminder**\n\nThis PR doesn't appear to include a changelog entry. Please consider adding one if this change affects users.\n\nChangelog files:\n- \`CHANGELOG.md\`\n- \`RELEASE_NOTES.md\`\n\nIf this is a chore, documentation, or CI-only change, you can ignore this message.`,
              });
            }

